post:
  summary: Create a UK Property Income & Expenses Period Summary
  description: |
    This endpoint allows a developer to submit the income and expenses for a UK property business. This submission is for either or both of Furnished Holiday Letting (FHL) and Non FHL UK property submissions. A National Insurance number, business ID and tax year are required.

    ### Test data
    <p>Scenario simulations using <code>Gov-Test-Scenario</code> headers is only available in the sandbox environment.</p>
    <table>
        <thead>
            <tr>
                <th>Header Value (Gov-Test-Scenario)</th>
                <th>Scenario</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><p>N/A - DEFAULT</p></td>
                <td><p>Simulate success response.</p></td>
            </tr>
            <tr>
                <td><p>NOT_FOUND</p></td>
                <td><p>Simulates the scenario where the given resource could not be found.</p></td>
            </tr>
            <tr>
                <td><p>OVERLAPPING</p></td>
                <td><p>Simulates the scenario where the period summary overlaps with an existing period summary.</p></td>
            </tr>
            <tr>
                <td><p>MISALIGNED</p></td>
                <td><p>Simulates the scenario where the period summary isn't within the accounting period.</p></td>
            </tr>
            <tr>
                <td><p>NOT_CONTIGUOUS</p></td>
                <td><p>Simulates the scenario where the period summaries are not contiguous.</p></td>
            </tr>
            <tr>
                <td><p>DUPLICATE_SUBMISSION</p></td>
                <td><p>Simulates the scenario where a summary has already been submitted for the specified period.</p></td>
            </tr>
            <tr>
                <td><p>TYPE_OF_BUSINESS_INCORRECT</p></td>
                <td><p>Simulates the scenario where the supplied Business ID does not represent a foreign property business.</p></td>
            </tr>        
        </tbody>
    </table>

  tags:
    - UK Property Income & Expenses Period Summary

  parameters:
    - $ref: '../pathParameters.yaml#/components/parameters/nino'
    - $ref: '../pathParameters.yaml#/components/parameters/businessId'
    - $ref: '../pathParameters.yaml#/components/parameters/taxYear'
    - $ref: '../headers.yaml#/components/parameters/acceptHeader'
    - $ref: '../headers.yaml#/components/parameters/contentTypeJson'
    - $ref: '../headers.yaml#/components/parameters/authorizationWriteScopeHeader'
    - $ref: '../headers.yaml#/components/parameters/testScenarioHeader'

  security:
    - User-Restricted:
        - write:self-assessment

  requestBody:
    content:
      application/json:
        schema:
          $ref: '../schemas/uk_property_period_summary_create/request.json'
        examples:
          full-expense-request:
            description: Full Expenses request
            value:
              $ref: '../examples/uk_property_period_summary_create/request.json'
          consolidated-expense-request:
            description: Consolidated Expenses request
            value:
              $ref: '../examples/uk_property_period_summary_create/consolidated_request.json'

  responses:
    "201":
      description: Success
      headers:
        X-CorrelationId:
          $ref: '../headers.yaml#/components/parameters/correlationId'
      content:
        application/json:
          schema:
            $ref: '../schemas/uk_property_period_summary_create/response.json'
          examples:
            example-response:
              description: Example Response
              value:
                $ref: '../examples/uk_property_period_summary_create/response.json'
    "400":
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '../schemas/error-response.yaml'
          examples:
            FORMAT_NINO:
              $ref: '../errors.yaml#/components/examples/formatNino'
            FORMAT_BUSINESS_ID:
              $ref: '../errors.yaml#/components/examples/formatBusinessId'
            FORMAT_TAX_YEAR:
              $ref: '../errors.yaml#/components/examples/formatTaxYear' 
            FORMAT_FROM_DATE:
              $ref: '../errors.yaml#/components/examples/formatFromDate' 
            FORMAT_TO_DATE:
              $ref: '../errors.yaml#/components/examples/formatToDate' 
            FORMAT_VALUE:
              $ref: '../errors.yaml#/components/examples/formatValue' 
            RULE_TAX_YEAR_RANGE_INVALID:
              $ref: '../errors.yaml#/components/examples/ruleTaxYearRangeInvalid' 
            RULE_TAX_YEAR_NOT_SUPPORTED:
              $ref: '../errors.yaml#/components/examples/ruleTaxYearNotSupported' 
            RULE_BOTH_EXPENSES_SUPPLIED:
              $ref: '../errors.yaml#/components/examples/ruleBothExpensesSupplied' 
            RULE_TYPE_OF_BUSINESS_INCORRECT:
              $ref: '../errors.yaml#/components/examples/ruleTypeOfBusinessIncorrectUk' 
            RULE_INCORRECT_OR_EMPTY_BODY_SUBMITTED:
              $ref: '../errors.yaml#/components/examples/ruleIncorrectOrEmptyBody' 
            RULE_TO_DATE_BEFORE_FROM_DATE:
              $ref: '../errors.yaml#/components/examples/ruleToDateBeforeFromDate' 
            RULE_OVERLAPPING_PERIOD:
              $ref: '../errors.yaml#/components/examples/ruleOverlappingPeriod' 
            RULE_MISALIGNED_PERIOD:
              $ref: '../errors.yaml#/components/examples/ruleMisalignedPeriod'          
            RULE_NOT_CONTIGUOUS_PERIOD:
              $ref: '../errors.yaml#/components/examples/ruleNotContiguousPeriod' 
            RULE_DUPLICATE_SUBMISSION:
              $ref: '../errors.yaml#/components/examples/ruleDuplicateSubmission' 

    "403":
      description: Forbidden
      content:
        application/json:
          schema:
            $ref: '../schemas/error-response.yaml'
          examples:
            CLIENT_OR_AGENT_NOT_AUTHORISED:
              $ref: '../errors.yaml#/components/examples/clientOrAgentNotAuthorised'

    "404":
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '../schemas/error-response.yaml'
          examples:
            MATCHING_RESOURCE_NOT_FOUND:
              $ref: '../errors.yaml#/components/examples/notFound'

